<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>안전한 물놀이 수칙 방탈출</title>
    <style>
        /* 기본 스타일 */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #000;
        }

        /* 게임 컨테이너 */
        #game-container {
            position: relative;
            width: 100%;
            max-width: 1280px; /* 이미지 원본 비율에 맞춘 최대 너비 */
            max-height: 853px; /* 이미지 원본 비율에 맞춘 최대 높이 */
            margin: auto;
            top: 50%;
            transform: translateY(-50%);
        }

        #game-container img {
            width: 100%;
            display: block;
        }

        /* 클릭 가능 오브젝트 공통 스타일 */
        .object {
            position: absolute;
            background-color: rgba(255, 255, 0, 0); /* 개발 시 확인을 위해 색상 사용, 최종본은 0으로 설정 */
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .object:hover {
             background-color: rgba(255, 255, 0, 0.3);
        }

        /* 오브젝트 위치 설정 (top, left, width, height를 %로 설정하여 반응형 대응) */
        #monitor { top: 43%; left: 16%; width: 15%; height: 18%; }
        #speaker { top: 12%; left: 24%; width: 5%; height: 9%; }
        #clock { top: 15%; left: 78%; width: 7%; height: 12%; }
        #pencil-case { top: 62%; left: 81%; width: 10%; height: 10%; }
        #door { top: 25%; left: 3%; width: 12%; height: 50%; }

        /* 모달 공통 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-content h2 { margin-top: 0; }
        .modal-content p { font-size: 1.1em; }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            font-weight: bold;
            color: #555;
            cursor: pointer;
        }

        .puzzle-options button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            font-size: 1em;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f0f0f0;
        }
        .puzzle-options button:hover { background-color: #ddd; }

        /* 메모리 카드 게임 스타일 */
        #memory-game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .card {
            width: 100%;
            padding-bottom: 100%; /* 정사각형 유지를 위한 트릭 */
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
        .card.flipped, .card.matched { transform: rotateY(180deg); }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            font-size: 0.8em;
        }
        .card-front {
            background-color: #4a90e2;
            color: white;
        }
        .card-back {
            background-color: #f5a623;
            color: white;
            transform: rotateY(180deg);
        }
        
        /* 비밀번호 입력 모달 */
        #password-input {
            width: 70%;
            padding: 15px;
            font-size: 1.5em;
            text-align: center;
            margin: 20px auto;
            letter-spacing: 0.2em;
        }
        #password-submit-btn {
            width: 75%;
            padding: 12px;
            font-size: 1.2em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <!-- 게임 화면 -->
    <div id="game-container">
        <img src="https://i.ibb.co/fVCPV3jd/Whisk-8ad83bd02f.jpg" alt="교실 배경">
        <!-- 클릭 가능 오브젝트 -->
        <div class="object" id="monitor" title="모니터"></div>
        <div class="object" id="speaker" title="벽 스피커"></div>
        <div class="object" id="clock" title="시계"></div>
        <div class="object" id="pencil-case" title="필통"></div>
        <div class="object" id="door" title="교실문"></div>
    </div>

    <!-- 힌트/문제/미니게임 모달 -->
    <!-- 1. 시계 (힌트) -->
    <div id="clock-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">×</span>
            <h2>벽시계</h2>
            <p>시계가 멈춰있다. 시계 뒷면에 무언가 적혀있다.</p>
            <p style="font-size: 1.5em; color: red; font-weight: bold;">"탈출 비밀번호의 마지막 숫자는 O와 관련이 깊다."</p>
        </div>
    </div>

    <!-- 2. 모니터 (문제 1) -->
    <div id="monitor-modal" class="modal">
        <div class="modal-content">
             <span class="close-btn">×</span>
            <h2>모니터 전원이 켜졌다!</h2>
            <p><strong>[문제]</strong> 물에 들어가기 전, 심장마비를 예방하고 체온을 적응시키기 위해 최소한 몇 분 동안 준비운동을 하는 것이 좋을까요?</p>
            <div class="puzzle-options">
                <button onclick="checkAnswer('monitor', '5분')">1. 5분</button>
                <button onclick="checkAnswer('monitor', '10분')">2. 10분</button>
                <button onclick="checkAnswer('monitor', '20분')">3. 20분</button>
            </div>
        </div>
    </div>

    <!-- 3. 스피커 (문제 2) -->
    <div id="speaker-modal" class="modal">
        <div class="modal-content">
             <span class="close-btn">×</span>
            <h2>스피커에서 안내방송이 나온다.</h2>
            <p><strong>[문제]</strong> 물에 빠진 사람을 발견했을 때, 가장 먼저 해야 할 위험한 행동은 무엇일까요?</p>
            <div class="puzzle-options">
                <button onclick="checkAnswer('speaker', '주변에 알리기')">1. "사람 살려!" 주변에 소리쳐 알린다.</button>
                <button onclick="checkAnswer('speaker', '도구 던지기')">2. 근처의 튜브나 긴 막대를 던져준다.</button>
                <button onclick="checkAnswer('speaker', '직접 들어가기')">3. 수영 실력을 믿고 즉시 물에 뛰어든다.</button>
            </div>
        </div>
    </div>
    
    <!-- 4. 필통 (미니게임) -->
    <div id="pencil-case-modal" class="modal">
        <div class="modal-content">
             <span class="close-btn">×</span>
            <h2>물놀이 안전 수칙 카드 맞추기</h2>
            <p>같은 그림의 카드를 두 개씩 찾아 짝을 맞추세요.</p>
            <div id="memory-game-board"></div>
        </div>
    </div>
    
    <!-- 5. 교실문 (비밀번호 입력) -->
    <div id="door-modal" class="modal">
        <div class="modal-content">
             <span class="close-btn">×</span>
            <h2>탈출</h2>
            <p>네 자리 비밀번호를 입력하고 문을 여세요.</p>
            <input type="number" id="password-input" maxlength="4" oninput="this.value=this.value.slice(0,4);">
            <button id="password-submit-btn">탈출하기</button>
        </div>
    </div>


    <script>
        // 전역 변수 및 상태
        const finalPassword = "2025";
        let solvedPuzzles = { monitor: false, speaker: false, clock: false, memoryGame: false };

        // DOM 요소 가져오기
        const objects = {
            monitor: document.getElementById('monitor'),
            speaker: document.getElementById('speaker'),
            clock: document.getElementById('clock'),
            pencilCase: document.getElementById('pencil-case'),
            door: document.getElementById('door')
        };

        const modals = {
            monitor: document.getElementById('monitor-modal'),
            speaker: document.getElementById('speaker-modal'),
            clock: document.getElementById('clock-modal'),
            pencilCase: document.getElementById('pencil-case-modal'),
            door: document.getElementById('door-modal')
        };
        
        // 모달 닫기 버튼 이벤트
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal').style.display = 'none';
            });
        });

        // 오브젝트 클릭 이벤트
        objects.monitor.addEventListener('click', () => modals.monitor.style.display = 'flex');
        objects.speaker.addEventListener('click', () => modals.speaker.style.display = 'flex');
        objects.clock.addEventListener('click', () => {
            modals.clock.style.display = 'flex';
            if (!solvedPuzzles.clock) {
                alert('[힌트 획득] 시계에서 쪽지를 발견했습니다.');
                solvedPuzzles.clock = true;
            }
        });
        objects.pencilCase.addEventListener('click', () => {
            modals.pencilCase.style.display = 'flex';
            if (!solvedPuzzles.memoryGame) {
                setupMemoryGame();
            }
        });
        objects.door.addEventListener('click', () => modals.door.style.display = 'flex');

        // 문제 정답 확인
        function checkAnswer(puzzle, answer) {
            const correctAnswers = {
                monitor: '10분',
                speaker: '직접 들어가기'
            };

            if (answer === correctAnswers[puzzle]) {
                if (!solvedPuzzles[puzzle]) {
                    let hint = '';
                    if (puzzle === 'monitor') hint = "비밀번호의 첫 두 자리는 '20' 입니다.";
                    if (puzzle === 'speaker') hint = "비밀번호의 세 번째 숫자는 두 번째 숫자와 같습니다.";
                    
                    alert(`정답입니다! [힌트 획득]\n${hint}`);
                    solvedPuzzles[puzzle] = true;
                } else {
                    alert('이미 해결한 문제입니다.');
                }
                modals[puzzle].style.display = 'none';
            } else {
                alert('틀렸습니다. 다시 생각해 보세요.');
            }
        }

        // 메모리 카드 게임 로직
        const memoryGameBoard = document.getElementById('memory-game-board');
        let cardItems = ['구명조끼', '준비운동', '안전요원', '튜브', '체온유지', '심장마비'];
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;

        function setupMemoryGame() {
            matchedPairs = 0;
            memoryGameBoard.innerHTML = '';
            let gameCards = [...cardItems.slice(0, 4), ...cardItems.slice(0, 4)];
            gameCards.sort(() => 0.5 - Math.random());

            gameCards.forEach(item => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.value = item;
                
                const cardFront = document.createElement('div');
                cardFront.classList.add('card-face', 'card-front');
                cardFront.textContent = '?';
                
                const cardBack = document.createElement('div');
                cardBack.classList.add('card-face', 'card-back');
                cardBack.textContent = item;
                
                card.appendChild(cardFront);
                card.appendChild(cardBack);
                memoryGameBoard.appendChild(card);

                card.addEventListener('click', flipCard);
            });
        }
        
        function flipCard() {
            if (flippedCards.length < 2 && !this.classList.contains('flipped')) {
                this.classList.add('flipped');
                flippedCards.push(this);

                if (flippedCards.length === 2) {
                    setTimeout(checkForMatch, 1000);
                }
            }
        }
        
        function checkForMatch() {
            const [card1, card2] = flippedCards;
            if (card1.dataset.value === card2.dataset.value) {
                card1.classList.add('matched');
                card2.classList.add('matched');
                card1.removeEventListener('click', flipCard);
                card2.removeEventListener('click', flipCard);
                matchedPairs++;
                if (matchedPairs === 4) {
                     setTimeout(() => {
                        alert("미니게임 성공! [힌트 획득]\n비밀번호의 마지막 숫자는 5입니다.");
                        solvedPuzzles.memoryGame = true;
                        modals.pencilCase.style.display = 'none';
                    }, 500);
                }
            } else {
                card1.classList.remove('flipped');
                card2.classList.remove('flipped');
            }
            flippedCards = [];
        }


        // 비밀번호 확인 로직
        document.getElementById('password-submit-btn').addEventListener('click', () => {
            const inputPassword = document.getElementById('password-input').value;
            if (inputPassword === finalPassword) {
                alert('🎉 탈출 성공! 🎉\n축하합니다! 안전한 물놀이 수칙을 모두 배우셨습니다!');
                modals.door.style.display = 'none';
            } else {
                alert('비밀번호가 틀렸습니다. 힌트를 다시 확인해보세요.');
            }
        });

    </script>
</body>
</html>